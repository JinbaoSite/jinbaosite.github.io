# 深度模型DeepFM模型

## 00 序言

Wide&Deep模型中Wide侧是一个广义线性模型，它具备捕获低阶特征交互的能力，通常是在特征向量中手动对低阶特征进行显性特征交互，但是它不能进行一些显性高阶特征交互以及一些很少出现在训练数据中的特征交互；而且Wide侧的输入依赖特征工程，更多需要人工进行设计特征输入，与Deep侧的输入无法进行输入共享。

因子分解机（FM）将成对特征交互建模为特征之间潜在向量的内积，并显示出非常有前景的结果；虽然原则上FM可以模拟高阶特征交互，但在实践中，由于高度复杂，通常只考虑二阶特征交互。

---

## 01 DeepFM模型

DeepFM模型是在原有Wide&Deep模型结构上改造而来，将Wide侧的LR模型替换成FM模型结构，从而组成了DeepFM模型，而且FM结构和Deep结构的输入是共享输入，可以在没有任何特征工程的情况下进行端到端的训练。DeepFM模型结构图如下
![DeepFM模型结构](https://s1.ax1x.com/2022/04/28/LXVpuD.png)
DeepFM模型的输出有FM结构和Deep结构相加得到
$$
\begin{aligned}
y = sigmoid(y_{FM} + y_{Deep})
\end{aligned}
$$

##### 1、FM结构

![FM结构](https://s1.ax1x.com/2022/04/28/LXue0O.png)
FM结构是由一阶的线性部分和二阶的交叉部分组成，一阶线性部分是给与每个特征一个权重，然后进行加权和；二阶交叉部分是对特征进行两两相乘，然后赋予权重加权求和。然后将两部分结果累加在一起即为FM的输出
$$
\begin{aligned}
y_{FM} = w_0 + \sum_{i=0}^n w_i x + \sum_{i=0}^{n} \sum_{j=i+1}^{n} <V_i, V_j> x_i x_j
\end{aligned}
$$

##### 2、Deep结构

![Deep结构](https://s1.ax1x.com/2022/04/28/LXMgfJ.png)
Deep结构是一个DNN模型，主要用来学习高阶隐性特征交互，不同Sparse特征经过Embedding层映射成相同维度的Dense特征，经过多个隐藏层进行特征交互学习，最后经过sigmoid激活函数得到输出。

---

## 03 DeepFM实现

```python

```

---

## 04 DeepFM优缺点

优点：

 - 可以同时学习低阶和高阶特征交互信息
 - 不需要像Wide&Deep模型那样需要特征工程

缺点：

 - 虽然可以学习

在推荐系统中，点击率（CTR）的预测至关重要，其任务是估计用户点击推荐项目的概率。在许多推荐系统中，目标是最大化点击次数，因此返回给用户的项目应该按照预估的CTR进行排名；而在在线广告等其他应用场景中，提高收入也很重要，因此排名策略可以调整为所有候选人的$CTR \times bid$，其中“bid”是用户点击项目时系统获得的收益。无论是哪种情况，很明显，关键在于正确估计CTR。

对于CTR预测来说，了解用户点击行为背后的隐含特征交互非常重要。通过在主流应用市场的研究，发现人们经常在用餐时间下载应用程序进行食品配送，这表明应用程序类别和时间戳之间的交互可以用作CTR的信号。第二个观察结果是，男性青少年喜欢射击游戏和RPG游戏，这意味着应用类别、用户性别和年龄的交互是CTR的另一个信号。一般来说，用户点击行为背后的功能交互可能非常复杂，低阶和高阶功能交互都应该发挥重要作用。根据谷歌的Wide&Deep的见解，与单独考虑低阶和高阶特征交互的情况相比，同时考虑低阶和高阶特征交互会带来额外的改进。

关键的挑战在于有效地建模特征交互。一些特性交互很容易理解，因此可以由经验得出。然而，大多数其他特征交互都隐藏在数据中，难以先验地识别，这只能通过机器学习自动捕获。即使对于易于理解的交互，实验似乎也不太可能对它们进行详尽的建模，尤其是在功能数量很大的情况下。

尽管简单，但FTRL等广义线性模型在实践中表现出了良好的性能。然而，线性模型缺乏学习特征交互的能力，通常的做法是在其特征向量中手动包含成对的特征交互。这种方法很难推广到建模高阶特征交互，或者那些从未或很少出现在训练数据中的交互。因子分解机（FM）将成对特征交互建模为特征之间潜在向量的内积，并显示出非常有前景的结果。虽然原则上FM可以模拟高阶特征交互，但在实践中，由于高度复杂，通常只考虑有序2特征交互。

作为一种学习特征表示的强大方法，深度神经网络具有学习复杂特征交互的潜力。一些想法将CNN和RNN扩展为CTR预测，但基于CNN的模型偏向于相邻特征之间的交互，而基于RNN的模型更适合具有顺序依赖性的点击数据。一些研究了特征表示，并提出了因子分解机器支持的神经网络（FNN）。该模型在应用DNN之前预先训练FM，因此受到FM能力的限制。一些研究了特征交互，在嵌入层和完全连接层之间引入了产品层，并提出了基于产品的神经网络（PNN）。如所述，PNN和FNN与其他深度模型一样，捕捉到的低阶特征交互作用很少，这对CTR预测也至关重要。为了对低阶和高阶特征交互进行建模，提出了一种有趣的混合网络结构（Wide&Deep），它结合了线性（“Wide”）模型和Depp模型。在该模型中，“Wide”和“Depp”分别需要两种不同的输入，而“宽部”的输入仍然依赖于特征工程。

可以看出，现有模型偏向于低阶和或高阶的特征交互，但通常学习二阶特征交互，对于更高阶的特征交互学习复杂度高，训练耗时长

---
 
## 05 参考资料

 - [DeepFM: A Factorization-Machine based N或者依赖于特征工程。在本文中，我们证明了一种学习模型是可能的，该模型能够以端到端的方式学习所有订单的特征交互，除了原始特征之外，不需要任何特征工程。我们的主要贡献总结如下：

 - 我们提出了一种新的神经网络模型DeepFM（图1），它集成了FM和deep neural Nnetwork for CTR Prediction](https://www.ijcai.org/proceedings/2017/0239.pdf)
 - [推荐算法(四)——经典模型 DeepFM 原理详解及代码实践](https://zhuanlan.zhihu.com/p/361451464)
 - [深度推荐模型之DeepFM](https://zhuanlan.zhihu.com/p/57873613)
 - [基于DeepFM模型的Embedding](https://zhuanlan.zhihu.com/p/384156476)s（DNN）的体系结构。它对FM等低阶特征交互进行建模，对DNN等高阶特征交互进行建模。与wide&deep模型不同[Cheng et al.，2016]，DeepFM可以在没有任何特征工程的情况下进行端到端的训练。
 - 与[Cheng等人，2016]不同，DeepFM可以有效地进行训练，因为它的宽部分和深部分共享相同的输入和嵌入向量。在[Cheng et al.，2016]中，输入向量可以是巨大的，因为它在其广泛部分的输入向量中包含手动设计的成对特征交互，这也大大增加了其复杂性。
 



